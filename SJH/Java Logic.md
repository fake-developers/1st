# 자바 언어의 동작 원리

- ### 들어가기 앞서

  - JVM이란?
    - 자바 가상머신(Java Virtual Machine)
    - 시스템 메모리를 관리하면서 자바 기반 애플리케이션을 위해 이식 가능한 실행환경 제공

<br>

- ### 자바 프로그램 구동 원리

  - 자바는 다른 프로그램과 달리 **OS에 독립**적인 특징을 가짐(플랫폼 독립성)
  - JVM이 이를 가능하게 해줌
  - OS가 JVM을 실행하고 JVM가 프로그램을 실행시킨다.

  ![java](https://user-images.githubusercontent.com/58902042/104819426-cd5df380-5870-11eb-8c72-187d1991e8a3.png)

  ![JVM](https://camo.githubusercontent.com/c8150cb199bef70f899d5eae4e9428f842a9acbe1cda76eb70894aa8d17d3030/68747470733a2f2f74312e6461756d63646e2e6e65742f6366696c652f746973746f72792f393942334635334235423735373943393039)

  - **과정**

    1. 소스코드를 작성(.java 확장장의 소스 파일)
    2. 컴파일러(javac.exe)가 바이트 코드로 변환(.class 확장자의 클래스 파일)
    3. 런처(java.exe)로 자바 가상 머신(JVM)을 구동시킴
    4. 자바 가상 머신이 바이트 코드를 해석하여 자바 프로그램이 실행됨

    ~~~
    <바이트 코드(Byte code)>
     - JVM이 이해할 수 잇는 언어로 변환된 코드
     - 반기계어 (컴퓨터가 아직 읽을 수 없는 단계)
     - JVM만 설치되어 있으면 "어떤 운영체제에서라도 실행 가능""
    ~~~

<br>

- ### JVM 내 동작 과정

  ![JVM logic](https://camo.githubusercontent.com/5dbdf8067125c9cfaf80f9665c02aa9f189178bf2d6d9adde0f86e15fd5420d1/68747470733a2f2f626c6f672e6b616b616f63646e2e6e65742f646e2f6238476778772f62747144624664455a64592f486f316b707a734e71467a3350627079384f6669466b2f696d672e706e67)

  1. 컴파일된 바이트 코드를 JVM의 클래스 로더에게 전달한다.

     1-1. 클래스 로더 세부 동작

     - 로드 : 클래스 파일을 가져와 JVM의 메모리에 로드
	
     - 검증 : 자바 언어 명세 및 JVM 명세에 명시된 대로 구성되어 있는지 검사
	
     - 준비 : 클래스가 필요로 하는 메모리를 할당(필드, 메서드, 인터페이스 등)
	
     - 분석 : 클래스의 상수 풀 내 모든 심복릭 레퍼런스를 다이렉트 레퍼런스로 변경
     	
     - 초기화 : 클래스 변수들을 적절한 값으로 초기화(static 필드)
     
        ​	`java에서 static으로 선언할 경우 클래스 로더가 JVM에 올릴때 static이 생성된다.`
     
  2. 클래스 로더는 **동적 로딩**을 통해 필요한 클래스들을 로딩 및 링크하여 **런타임 데이터 영역 즉, JVM의 메모리**에 올린다.

  3. **실행엔진**은 JVM 메모리에 올라온 바이트 코드를 명령어 단위로 하나씩 가져와서 실행한다(2가지 방식).

     > 1. 자바 인터프리터
     >    - 바이트 코드 명령어를 하나씩 읽어 해석하고 실행
     >    - 하나하나의 실행은 빠르나, 전체적인 실행 속도가 느림
     > 2. JIT 컴파일러(Just-In-Time Compiler)
     >    - 인터프리터의 단점을 보완하기 위해 도입된 방식
     >    - 바이트 코드 전체를 컴파일하여 바이너리 코드로 변경, 이후에는 해당 메서드를 더 이상 인터프리팅하지 않고 바이너리 코드로 직접 실행
     >    - 전체적인 실행속도는 인터프리팅 방식보다 빠름

<br>

-----------

- ###  예상질문

  1. **JVM이란 무엇인가?**
     - 자바 코드를 실행시키기 위한 가상 머신으로, OS으로부터 메모리를 할당 받아 로딩된 바이트 코드를 실행하는 역할을 한다.

  

  2. **Java 프로그램의 동작 과정은 무엇인가?**
     - 자바 컴파일러가 자바 코드를 해석하여 바이트 코드를 만들면 그것을 JVM이 해석하여 실행한다.

----------

<참조>

- [JVM이란 무엇인가?](https://www.itworld.co.kr/news/110837)
- <https://github.com/fake-developers/1st/blob/main/KJY/%5BJAVA%5D%20%EC%9E%90%EB%B0%94%20%EC%96%B8%EC%96%B4%20%EB%8F%99%EC%9E%91%20%EC%9B%90%EB%A6%AC.md>
- <https://github.com/fake-developers/1st/blob/main/JYJ/JavaOperation.md>