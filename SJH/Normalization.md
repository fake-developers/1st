# 정규화

<br>

### 데이터베이스 정규화란?

- 이상 문제를 해경하기 위해 속성들끼리의 종속 관계를 분석하여 여러개의 릴레이션으로 분해하는 과정이다.

- 일반적으로 테이블을 여러개로 **분해하면 속도는 상대적으로 느려질** 수 있지만, **분해하지 않으면 이상 문제들이 발생** 한다.

  <details>
      <summary> 이상문제 </summary>    

  - 삽입 이상

    - 데이터를 저장할 때 원하지 않는 정보가 함께 삽입되는 경우

  * 삭제 이상

    * 튜플을 삭제함으로써 유지되어야 하는 정보까지도 연쇄적으로 삭제되는 경우

  * 갱신 이상

    * 중복된 튜플 중 일부의 속성만 갱신 시키므로써 정보의 모순성이 발생하는 경우

  * ex_)

     <img src="https://user-images.githubusercontent.com/58902042/106350723-71887580-631a-11eb-805c-99e17d622405.PNG" height=300> 

    - 삽입 이상
      - 신입생이 입학하여 학번과 학년 등을 입력하려 했으나 아직 과목이 정해지지 않났거나, 시험을 보지 않아 성적이 없는 상태이기 때문에 불필요한 정보(과목 이름, 성적)을 함께 삽입해야 한다.
    - 삭제 이상
      - 학생 번호가 2번인 학생의 과목에 대한 성적을 삭제할 경우, 학생 번호와 학년 등 모든 정보가 같이 삭제 되어 학생 정보 자체가 사라지게 된다.
    - 갱신 이상
      - 학생 번호가 3번인 학생이 2학년이 되어 학년 정보를 변경하려 하는데 3개를 모두 하나씩 바꾸어 주어야 한다.
      - 하나라도 바뀌지 않을 경우 한명의 학생에 대한 정보가 서로 달라지는 정보의 모순성이 발생한다.

  </details>

<br>

### 정규화의 목적

- 불필요한 데이터를 제거하여 중복을 최소화 하고 정보의 일관성을 보장하기 위해서 사용한다.
- 데이터의 모형을 단순화시키기 위해 사용한다.
- 데이터 구조의 안정성과 무결성을 유지하기 위해 사용한다.
- 엔터티와 속성의 누락 여부를 검증할 수 있다.
- 자료 검색과 추출의 효율성을 추구할 수 있다.

<br>

### 함수적 종속성이란?

- 어떠한 릴레이션에서 속성들의 부분 집합을 X, Y라 할 때, 특정 튜플에서 X의 값이 Y의 값을 함수적으로 경정한다면 Y가 X에 함수적으로 종속되었다고 한다.
  - 재귀 규칙 : Y가 X의 부분 집합이면 X -> Y 이다.
  - 증가 규칙 : X -> Y 이면 WX -> WY 이고 WX -> Y 이다.
  - 이행 규칙 : X -> Y 이고 Y -> Z 이면 X -> Z 이다.
  - 유니온 규칙 : X -> Y 이고 X -> Z 이면 X -> YZ 이다.
  - 분해 규칙 : X -> YZ 이면 X -> Y 와 X -> Z 이다.
  - 가이행 규칙 : 만일 W -> X 이고 XY -> Z 이면 WY -> Z 이다.

<br>

### 정규화 과정

- #### 제1정규형(1NF)

  - **도메인은 모두 원자값**이어야 한다.

  - 관계형 데이터베이스의 경우 기본적으로 도메인은 모두 원자값이라 제1정규형이 지켜져 있다.

  - ex_) 

    - 정규화 수행 전

       <img src="https://user-images.githubusercontent.com/58902042/106351066-1b690180-631d-11eb-8510-f73041ef8dcb.PNG" width =500> 

      - 핸드폰 번호에 2개의 번호가 들어가 있어 제1정규형을 만족하지 않는다.

    --------

    - 정규화 수행 후

      <img src="https://user-images.githubusercontent.com/58902042/106351093-52d7ae00-631d-11eb-983c-fa794279f070.PNG" width =500> 

     

    

- #### 제2정규형(2NF)

  - **부분 함수 종속성을 제거**한다.

    ~~~
    <부분 함수적 종속> 
    - 릴레이션에서 종속자가 기본키가 아닌 다른 속성에 종속되거나, 기본키가 여러 속성으로 구성되어 있을 경우 기본키를 구성하는 속성 중 일부만 종속되는 경우
    ~~~

  - ex_)

    - 정규화 수행 전

        <img src="https://user-images.githubusercontent.com/58902042/106351095-55d29e80-631d-11eb-8169-9b1ebe86c85b.PNG" width =500>

      - 학번은 학부와 등록금을 결정할 수 있고, 학번과 과목 코드는 성적을 결정할 수 있다.
      - 부분 함수인 학번 혼자서 학부와 등록금을 결정할 수 있다.
      - 즉, 제2규형을 만족할 수 없다.

    -----------

    - 정규화 수행 후

      - 성적, 학부, 등록금에 모두 영향을 주는 학번을 기준으로 릴레이션을 분리 시킨다.

       <img src="https://user-images.githubusercontent.com/58902042/106351097-59febc00-631d-11eb-98c2-a18b28be082e.PNG" width =350>

       <img src="https://user-images.githubusercontent.com/58902042/106351099-5e2ad980-631d-11eb-9928-76551065465b.PNG" width =250>

      



- #### 제3정규형(3NF)

  - **이행 함수 종속을 제거**한다.

  - ex_)

    - 정규화 수행 전

        <img src="https://user-images.githubusercontent.com/58902042/106351408-59672500-631f-11eb-961e-b39a1b72d043.PNG" width =380>

        <img src="https://user-images.githubusercontent.com/58902042/106351410-5cfaac00-631f-11eb-8bef-7d18e7f9a0ea.PNG" width =280>

      - 밑 테이블은 학번(X)이 학부(Y)를 결정하고, 학부(Y)가 등록금(Z)를 결정하고, 이행 규칙에 따라 학번(X)가 등록금(Z)를 결정할 수 있다.
      - 이행 규칙을 만족하므로 제3규형을 만족시키지 못한다.

    -----------

    - 정규화 수행 후

      - X -> Y, Y -> Z의 형태로 릴레이션을 다시 분해한다.

      <img src="https://user-images.githubusercontent.com/58902042/106351413-5e2bd900-631f-11eb-971b-43ebe6df3ef5.PNG" width =200> <img src="https://user-images.githubusercontent.com/58902042/106351414-5ec46f80-631f-11eb-933c-d514a1c775bb.PNG" width =250>

      <img src="https://user-images.githubusercontent.com/58902042/106351415-608e3300-631f-11eb-9de6-f7f9ea15ee74.PNG" width =250> 





- #### 보이스 코드 정규형(BCNF)

  - 제3정규형을 조금 더 강화한 버전으로 볼 수 있다.

    - 제3정규형으로 해결할 수 없는 이상 현상을 해결한다.

  - **모든 결정자가 후보키 집합에 속한 정규형**이다.

  - ex_)

    - 정규화 수행 전

      | 학생* | 과목* | 교수   | 학점 |
      | ----- | ----- | ------ | ---- |
      | 1     | AB123 | 김인영 | A    |
      | 2     | CS123 | Mr.Sim | A    |
      | 3     | CS123 | Mr.Sim | A    |

      - 후보키인 학생, 과목으로 그 행(row)를 유일하게 구분할 수 있다.

      - 이 테이블의 경우 교수가 결정자이다.

        > 교수가 한 과목만 강의 할 수 있다고 가정한다.
        >
        > 즉, 교수가 정해지면 과목이 결정된다.

      - 교수는 후보키가 아니기 때문에 이 경우, BCNF를 만족하지 못한다.

      - 위와 같이 테이블이 구성되면, 데이터가 중복되고 갱신 이상을 발생시킨다.

      - Mr.Sim이 강의하는 과목명이 바뀌면 두 개의 행(row)를 모두 갱신해야 한다.

      - 이 문제를 해결하기 위해 테이블을 분리한다.

    ---------

    - 정규화 수행 후

      - 교수 테이블

        | 교수   | 과목  |
        | ------ | ----- |
        | 김인영 | AB123 |
        | Mr.Sim | CS123 |

      - 수강 테이블

        | 학생 | 과목  | 학점 |
        | ---- | ----- | ---- |
        | 1    | AB123 | A    |
        | 2    | CS123 | A    |
        | 3    | CS123 | A    |





- #### 제4정규형(4NF)

  - 데이터베이스의 이상 현상의 원인이 되는 **데이터 중복성을 제거**하여 무결성을 보존하는 거이다.

  - **다치 종속성을 제거 **하고, 특성 속성값에 따라 **선택적인 속성을 분리** 하는 과정이다.

  - ex_)

    - 정규화 수행 전

      | 개발자 | 자격증             | 언어 |
      | ------ | ------------------ | ---- |
      | 홍길동 | 정보처리기사       | C    |
      | 홍길동 | 빅데이터 분석 기사 | C++  |
      | 장길산 | 정보처리기사       | JAVA |

      - 개발자 마다 자격증 값이 존재하고, 특정 개발자 마다 언어 값들이 존재하는 경우 다치 종속 관계라고 한다.
      - <개발자, 자격증>과 <개발자, 언어> 테이블로 분리하여 관리하면 다치 종속 관계를 제거할 수 있다.

    ------

    - 정규화 수행 후

      - <개발자, 자격증> 테이블

        | 개발자 | 자격증             |
        | ------ | ------------------ |
        | 홍길동 | 정보처리기사       |
        | 홍길동 | 빅데이터 분석 기사 |
        | 장길산 | 정보처리기사       |

      - <개발자, 언어> 테이블

        | 개발자 | 언어 |
        | ------ | ---- |
        | 홍길동 | C    |
        | 홍길동 | C++  |
        | 장길산 | JAVA |





- #### 제5정규형(5NF)

  - **릴레이션에 존재하는 조인 종속의 후보키를 통해서만 성립이 되도록하는 정규형** 을 말한다.

    ~~~
    <조인 종속>
    - 원래의 릴레이션을 분해한 뒤 자연 조인한 결과가 원래의 릴레이션과 같은 결과가 나오는 종속성을 말한다.
    ~~~

  - ex_)

    - 정규화 수행 전

      | 사원   | 기술       | 언어     |
      | ------ | ---------- | -------- |
      | 홍길동 | 모델링     | 영어     |
      | 홍길동 | 파워포인트 | 중국어   |
      | 홍길동 | 모델링     | 프랑스어 |
      | 김길동 | 파워포인트 | 일어     |

      - 사원이 보유한 기술과 구사하는 언어와 관계가 있다는 업무 요건이 존재할 경우, 세속성 사이에 연관성이 존재하며, 조인 종속이 존재하기 때문에 제5정규화 대상이다.

    -----------

    - 정규화 수행 후

      - <사원, 기술> 테이블

        | 사원   | 기술       |
        | ------ | ---------- |
        | 홍길동 | 모델링     |
        | 홍길동 | 파워포인트 |
        | 김길동 | 파워포인트 |

      - <기술, 언어> 테이블

        | 기술       | 언어     |
        | ---------- | -------- |
        | 모델링     | 영어     |
        | 파워포인트 | 중국어   |
        | 모델링     | 프랑스어 |
        | 파워포인트 | 일어     |

      - <사원, 언어> 테이블

        | 사원   | 언어     |
        | ------ | -------- |
        | 홍길동 | 영어     |
        | 홍길동 | 중국어   |
        | 홍길동 | 프랑스어 |
        | 김길동 | 일어     |

<br>

-----

### 예상질문 :bulb:

1. **데이터베이스를 분해하지 않을 때 발생할 수 있는 이상문제**에 대한 설명하시오.
   - 데이터를 저장할 때 원하지 않는 정보가 함께 삽입되는 **삽입이상**, 튜플을 삭제함으로써 유지되어야 하는 정보까지도 연쇄적으로 삭제되는 **삭제이상**, 중복된 튜플 중 일부의 속성만 갱신 시키므로써 정보의 모순성이 발생하는 **갱신이상**



2. **정규화를 하는 목적**은 무엇인가?
   - 중복을 최소화 하고 정보의 일관성을 보장하기위해서 
   - 또한, 데이터 구조의 안정성과 무결성을 위해 사용한다.

<br>

----------

**<참조>**

- https://github.com/fake-developers/1st/blob/JYJ-04/JYJ/Normalization.md



