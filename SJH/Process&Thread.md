
# 프로세스와 쓰레드

- #### 들어가기 앞서
  - 프로그램
  	- 파일이 저장 장치에 저장되어 있지만 메모리에는 올라가 있지 않은 정적인 상태, 즉 실행되지 않는 상태를 의미한다.

  <br/>

- #### 프로세스란?

  - 컴퓨터에서 연속적으로 실행되고 있는 컴퓨터 프로그램

  - 메모리에 올라와 실행되고 있는 프로그램의 인스턴스(독립적인 객체)
  - 운영체제로부터 시스템 자원<small>(cpu, 메모리 등)</small>을 할당받는 작업의 단위
  - 동적인 의미로 실행된 프로그램을 의미한다. <small>(.exe 파일 등을 클릭하여 실행시킨 상태)</small>

<br/>

- #### 프로세스의 특징

  ![process](https://user-images.githubusercontent.com/61674527/103727119-d69fc280-501d-11eb-8d16-7318ed1a88b3.jpg)

  - 프로세스는 각각 독립된 메모리 영역(Code, Data, Stack, Heap)을 할당 받는다.

    ```
      - Code 영역
        프로세스가 실행할 코드와 매크로 상수가 기계어의 형태로 저장된 공간
      
      - Data 영역
        코드에서 선언한 전역변수 또는 static 변수 등등이 저장된 공간
        
      - Stack 영역
        지역변수, 매개변수, 리턴값, 돌아올 주소 등이 저장된 공간
        함수가 지역변수를 너무 많이 가져 stack 영역 초과 시 stack overflow 발생
        
      - Heap 영역
        필요에 의해 메모리를 동적 할당하고자 할 때 사용되는 공간
        메모리 주소 값에 의해서만 참조되고 사용하는 뎡역
        ex) C에서 malloc()로 Heap에 데이터 저장
    ```

  - 기본적으로 프로세스당 최소 1개의 스레드를 가지고 있다.

  - 각 프로세스는 별도의 주소 공간에서 실행되며, 한 프로세스는 다른 프로세스의 변수나 자료구조에 접근할 수 없다. 

    <small>+) 하나의 프로세스가 강제 종료되어도, 다른 프로세스에게 영향을 주지 않는다.</small>

  - 접근을 위해서는 소켓 통신 등 프로세스간 통신이 필요하다.

  <br/>

- #### 쓰레드란?

  ```
  프로그램 하나가 단순히 한 작업만을 하는 경우는 없기 때문에, 그것을 처리하기 위한 프로세스 보다 더 작은 개념이 필요
  ```

  - 프로세스 내 실행되는 여러 실행 흐름의 단위
    
  - 프로세스 코드에 의해 정의된 절차에 따라 실행되는 특정한 수행 경로
    
  - 프로세스가 할당받은 자원을 이용하는 실행의 단위
    
    

  <br/>

- #### 쓰레드의 특징

  ![Thread](https://user-images.githubusercontent.com/61674527/103727143-e8816580-501d-11eb-81de-8c04a4a50f4c.jpg)

  - 프로세스 메모리 영역 중  stack만 각자 따로 할당 받고 code, data, heap 영역은 공유한다.

  - 같은 프로세스 내의 여러 쓰레드는 프로세스의 주소 공간이나 자원들을 서로 공유하면서 실행된다.

  - 같은 프로세스 내의 여러 쓰레드 들은 같은 힙 공간을 공유한다. 

    <small> cf. 프로세스는 다른 프로세스의 메모리에 직접 접근할 수 없다.</small>

  - 한 쓰레드가 프로세스 자원을 변경하면, 다른 이웃 쓰레드도 그 변경 결과를 즉시 볼 수 있다.

    <small>+)  메모리 영역의 내용을 공유하기 때문에 쓰레드 하나에서 오류가 나면 같은 프로세스 내 다른 쓰레도 모두 강제 종료된다.</small>

    <br/>

- #### 멀티 프로세스와 멀티 쓰레드

  - **멀티 프로세스**

    - 하나의 응용 프로그램을 여러 개의 프로세스로 구성하여 각 프로세스가 하나의 작업을 처리하도록 하는 것을 의미한다.

    - 여러 자식 프로세스 중 하나에 문제가 발생해도 다른 프로세스에 영향을 주지 않는다.

    - 무거운 작업이 진행되고, 많은 시간이 소모 되는 등 오버헤드가 발생할 수 있다.

      <br/>

  - **멀티 쓰레드**

    - 하나의 응용 프로그램을 여러 개의 쓰레드로 구성하여 각 쓰레드로 하여금 하나의 작업을 처리하도록 하는 것이다.

      <small>+) 즉, 프로그램을 여러 개 키는 것 보다 하나의 프로그램 안에서 여러 작업을 해결하는 것이다.</small>

    - 프로세스 간 통신 보다 쓰레드 간의 통신 비용이 적어 작업들 간 통신의 부담이 줄어든다.
    
	  <br>
  
  - #### 멀티 프로세스 대신 멀티 스레드를 사용하는 이유
  
    ![multi Thread](https://user-images.githubusercontent.com/61674527/103727171-fafb9f00-501d-11eb-9f31-9bcc6b4d93cd.jpg)
  
    1. **자원의 효율성 증대**
       - 프로세스를 생성하여 자원을 할당하는 시스템 콜이 줄어든다.
       - 쓰레드는 프로세스 내의 메모리를 공유하기 때문에 독립적인 프로세스와 달리 쓰레드 간 데이터를 주고 받는 것이 간단해지고 시스템 자원 소모가 줄어들게 된다.
    2. **처리 비용 감소 및 응답 시간 단축**
       - 프로세스 간의 통신(IPC)보다 쓰레드 간의 통신의 비용이 적으므로 작업들 간의 통신의 부담이 줄어든다.
       - 프로세스 간의 전환 속도보다 쓰레드 간의 전환 속도가 빠르다.
  
    - **주의할 점**
      - 동기화 문제
      - 스레드 간의 자원 공유는 전역 변수(데이터 세그먼트)를 이용하므로 함께 상용할 때 충돌이 발생할 수 있다.

----------------

<참고>

- <https://github.com/fake-developers/1st/blob/BJY-01/BJY/Process%26Thread.md>
- <https://github.com/fake-developers/1st/blob/JYJ-01/JYJ/ProcessAndThread.md>